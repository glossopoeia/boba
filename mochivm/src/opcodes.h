// This defines the bytecode instructions used by the VM. It does so by invoking
// an OPCODE() macro which is expected to be defined at the point that this is
// included. (See: http://en.wikipedia.org/wiki/X_Macro for more.)
//
// Note that the order of instructions here affects the order of the dispatch
// table in the VM's interpreter loop. That in turn affects caching which
// affects overall performance. Take care to run benchmarks if you change the
// order here.

OPCODE(NOP)
OPCODE(BREAKPOINT)
OPCODE(ABORT)

OPCODE(PERM_QUERY)
OPCODE(PERM_REQUEST)
OPCODE(PERM_REQUEST_ALL)
OPCODE(PERM_REVOKE)
OPCODE(JUMP_PERMISSION)
OPCODE(OFFSET_PERMISSION)

OPCODE(TRUE)
OPCODE(FALSE)
OPCODE(BOOL_NOT)
OPCODE(BOOL_AND)
OPCODE(BOOL_OR)
OPCODE(BOOL_NEQ)
OPCODE(BOOL_EQ)

OPCODE(CONSTANT)

OPCODE(INT_NEG)
OPCODE(INT_INC)
OPCODE(INT_DEC)
OPCODE(INT_ADD)
OPCODE(INT_SUB)
OPCODE(INT_MUL)
OPCODE(INT_DIV_REM_T)
OPCODE(INT_DIV_REM_F)
OPCODE(INT_DIV_REM_E)
OPCODE(INT_OR)
OPCODE(INT_AND)
OPCODE(INT_XOR)
OPCODE(INT_COMP)
OPCODE(INT_SHL)
OPCODE(INT_SHR)
OPCODE(INT_EQ)
OPCODE(INT_LESS)
OPCODE(INT_GREATER)
OPCODE(INT_SIGN)

OPCODE(SINGLE_NEG)
OPCODE(SINGLE_ADD)
OPCODE(SINGLE_SUB)
OPCODE(SINGLE_MUL)
OPCODE(SINGLE_DIV)
OPCODE(SINGLE_EQ)
OPCODE(SINGLE_LESS)
OPCODE(SINGLE_GREATER)
OPCODE(SINGLE_SIGN)

OPCODE(DOUBLE_NEG)
OPCODE(DOUBLE_ADD)
OPCODE(DOUBLE_SUB)
OPCODE(DOUBLE_MUL)
OPCODE(DOUBLE_DIV)
OPCODE(DOUBLE_EQ)
OPCODE(DOUBLE_LESS)
OPCODE(DOUBLE_GREATER)
OPCODE(DOUBLE_SIGN)

OPCODE(VALUE_CONV)

OPCODE(STORE)
OPCODE(FIND)
OPCODE(OVERWRITE)
OPCODE(FORGET)

OPCODE(CALL_FOREIGN)

OPCODE(OFFSET)
OPCODE(CALL)
OPCODE(TAILCALL)
OPCODE(CALL_CLOSURE)
OPCODE(TAILCALL_CLOSURE)
OPCODE(RETURN)

OPCODE(JUMP_TRUE)
OPCODE(JUMP_FALSE)
OPCODE(OFFSET_TRUE)
OPCODE(OFFSET_FALSE)

OPCODE(CLOSURE)
OPCODE(RECURSIVE)
OPCODE(MUTUAL)
OPCODE(CLOSURE_ONCE)
OPCODE(CLOSURE_ONCE_TAIL)
OPCODE(CLOSURE_MANY)

OPCODE(HANDLE)
OPCODE(INJECT)
OPCODE(EJECT)
OPCODE(COMPLETE)
OPCODE(ESCAPE)
OPCODE(CALL_CONTINUATION)
OPCODE(TAILCALL_CONTINUATION)

OPCODE(THREAD_SPAWN)
OPCODE(THREAD_SPAWN_WITH)
OPCODE(THREAD_SPAWN_COPY)
OPCODE(THREAD_CURRENT)
OPCODE(THREAD_SLEEP)
OPCODE(THREAD_YIELD)
OPCODE(THREAD_JOIN)
OPCODE(THREAD_EQUAL)

OPCODE(ZAP)
OPCODE(DUP)
OPCODE(SWAP)
OPCODE(SHUFFLE)

OPCODE(NEWREF)
OPCODE(GETREF)
OPCODE(PUTREF)

OPCODE(CONSTRUCT)
OPCODE(DESTRUCT)
OPCODE(IS_STRUCT)
OPCODE(JUMP_STRUCT)
OPCODE(OFFSET_STRUCT)

OPCODE(RECORD_NIL)
OPCODE(RECORD_EXTEND)
OPCODE(RECORD_SELECT)
OPCODE(RECORD_RESTRICT)
OPCODE(RECORD_UPDATE)

OPCODE(VARIANT)
OPCODE(EMBED)
OPCODE(IS_CASE)
OPCODE(JUMP_CASE)
OPCODE(OFFSET_CASE)

OPCODE(LIST_NIL)
OPCODE(LIST_CONS)
OPCODE(LIST_HEAD)
OPCODE(LIST_TAIL)
OPCODE(LIST_IS_EMPTY)
OPCODE(LIST_APPEND)

OPCODE(ARRAY_NIL)
OPCODE(ARRAY_FILL)
OPCODE(ARRAY_SNOC)
OPCODE(ARRAY_GET_AT)
OPCODE(ARRAY_SET_AT)
OPCODE(ARRAY_LENGTH)
OPCODE(ARRAY_COPY)
OPCODE(ARRAY_CONCAT)

OPCODE(ARRAY_SLICE)
OPCODE(SUBSLICE)
OPCODE(SLICE_GET_AT)
OPCODE(SLICE_SET_AT)
OPCODE(SLICE_LENGTH)
OPCODE(SLICE_COPY)

OPCODE(BYTE_ARRAY_NIL)
OPCODE(BYTE_ARRAY_FILL)
OPCODE(BYTE_ARRAY_SNOC)
OPCODE(BYTE_ARRAY_GET_AT)
OPCODE(BYTE_ARRAY_SET_AT)
OPCODE(BYTE_ARRAY_LENGTH)
OPCODE(BYTE_ARRAY_COPY)
OPCODE(BYTE_ARRAY_CONCAT)

OPCODE(BYTE_ARRAY_SLICE)
OPCODE(BYTE_SUBSLICE)
OPCODE(BYTE_SLICE_GET_AT)
OPCODE(BYTE_SLICE_SET_AT)
OPCODE(BYTE_SLICE_LENGTH)
OPCODE(BYTE_SLICE_COPY)

OPCODE(STRING_CONCAT)